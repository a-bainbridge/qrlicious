let p;function check(e,i){if(e>=0&&i>=0&&e<columns&&i<rows)return board[e+i*columns]}function picture(e){return tile[e].innerHTML}function init(){for(document.getElementById("status").innerHTML="Click on the tiles to reveal them",mines=5,rows=4,columns=20,remaining=mines,tile=[],board=[],revealed=0,i=0;i<rows*columns;i++)tile[i]=document.createElement("p"),tile[i].innerHTML="E",tile[i].style="position:absolute;height:30px; width: 30px",tile[i].style.top=50+30*Math.floor(i/columns),tile[i].style.left=400+i%columns*30,tile[i].addEventListener("mousedown",click),tile[i].id=i,document.body.appendChild(tile[i]);placed=0;do{i=Math.floor(Math.random()*columns*rows),"mine"!=board[i]&&(board[i]="mine",placed++)}while(placed<mines);for(var e=0;e<columns;e++)for(y=0;y<rows+1;y++)"mine"!=check(e,y)&&(board[e+y*columns]=("mine"==check(e,y+1)|0)+("mine"==check(e-1,y+1)|0)+("mine"==check(e+1,y+1)|0)+("mine"==check(e,y-1)|0)+("mine"==check(e-1,y-1)|0)+("mine"==check(e+1,y-1)|0)+("mine"==check(e-1,y)|0)+("mine"==check(e+1,y)|0))}function click(e){var n=e.target;if(id=n.id,3==e.which){switch(picture(id)){case"E":tile[id].innerHTML="f",remaining--;break;case"f":tile[id].innerHTML="?",remaining++;break;case"?":tile[id].innerHTML="E"}e.preventDefault()}if(document.getElementById("status").innerHTML="Mines remaining: "+remaining,1==e.which&&"f"!=picture(id))if("mine"==board[id]){for(i=0;i<rows*columns;i++)"mine"==board[i]&&(tile[i].innerHTML="x"),"mine"!=board[i]&&"f"==picture(i)&&(tile[i].innerHTML="0");document.getElementById("status").innerHTML="GAME OVER<br><br>Click here to restart"}else"E"==picture(id)&&reveal(id);revealed==rows*columns-mines&&(document.getElementById("status").innerHTML="YOU WIN!<br><br>Click here to restart")}function reveal(e){"mine"!=board[e]&&"E"==picture(e)&&revealed++,tile[e].innerHTML=board[e];var i=e%columns,n=Math.floor(e/columns);0==board[e]&&(i>0&&"E"==picture(e-1)&&reveal(e-1),i<columns-1&&"E"==picture(+e+1)&&reveal(+e+1),n<rows-1&&"E"==picture(+e+columns)&&reveal(+e+columns),n>0&&"E"==picture(e-columns)&&reveal(e-columns),i>0&&n>0&&"E"==picture(e-columns-1)&&reveal(e-columns-1),i<columns-1&&n<rows-1&&"E"==picture(+e+columns+1)&&reveal(+e+columns+1),i>0&&n<rows-1&&n<rows-1&&"E"==picture(+e+columns-1)&&reveal(+e+columns-1),i<columns-1&&n>0&&n<rows-1&&"E"==picture(+e-columns+1)&&reveal(+e-columns+1))}